#include <mpi.h>
#include <iostream>
#include <vector>

int main(int argc, char** argv) {

    // ================================
    // Инициализация MPI
    // ================================
    MPI_Init(&argc, &argv);

    int rank, size;

    // rank — номер текущего процесса (0,1,2,...)
    MPI_Comm_rank(MPI_COMM_WORLD, &rank);

    // size — общее количество процессов
    MPI_Comm_size(MPI_COMM_WORLD, &size);

    // ================================
    // Общий размер массива
    // ================================
    int N = 1000000;

    // Каждый процесс обрабатывает свою часть массива
    int local_n = N / size;

    // Создаём локальный массив для данного процесса
    std::vector<int> local(local_n, 1);   // заполняем единицами

    // ================================
    // Локальное вычисление
    // ================================
    // Каждый процесс считает сумму своей части массива
    int local_sum = 0;
    for (int x : local)
        local_sum += x;

    // ================================
    // Сбор результатов со всех процессов
    // ================================
    int global_sum = 0;

    // MPI_Reduce суммирует все local_sum со всех процессов
    // и сохраняет результат в global_sum у процесса с rank = 0
    MPI_Reduce(&local_sum, &global_sum,
               1, MPI_INT,
               MPI_SUM,
               0, MPI_COMM_WORLD);

    // ================================
    // Вывод результата
    // ================================
    // Только процесс с rank = 0 выводит итоговую сумму
    if (rank == 0)
        std::cout << "Global sum = " << global_sum << std::endl;

    // Завершение работы MPI
    MPI_Finalize();
}
